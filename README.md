# 材料費原価計算エンジン

直接材料費の原価計算と入出庫履歴の作成を自動化するRustアプリケーションです。Excelファイルから生産データ、配合マスタ、仕入データ、売上データを読み取り、材料費計算と在庫管理を実行して結果をExcelファイルに出力します。

## ユースケース

本システムは2つのユースケースを提供します：

1. **材料費の算出**
2. **入出庫履歴の作成**

## 計算式

### 材料費計算

#### 原砂金額

```
原砂金額 = Σ(材料消費数量 × 仕入単価)

ここで、
材料消費数量 = 生産数量 × 消費比率
```

#### 原砂歩留金額

```
原砂歩留金額 = 原砂金額 × 歩留率
```

#### 材料費

```
材料費 = 原砂歩留金額 + 凝集剤 + 粘土処理
```

### 在庫残高計算

```
新残高 = 基準数量 + 増減数量

ここで、
増減数量 = {
  生産・仕入の場合: +数量
  売上の場合: -数量
}
```

## 設定

`config.toml`で入出力ファイルパスを設定します。

```toml
[paths]
input_file = "tests/直接材料費原価計算表.xlsx"
output_file = "tests/直接材料費原価計算表_結果.xlsx"
```

## 使用方法

### ビルド

```bash
cargo build --release
```

### 実行結果

- コンソールに処理状況が表示されます
- 計算結果が出力ファイルに保存されます
- syslogシートに全ログが記録されます
- エラーが発生した場合は、詳細なエラーメッセージが表示されます


### 日付バリデーション

日付は以下の形式をサポートします：
- YYYY-MM-DD (例: 2024-01-15)
- YYYY/MM/DD (例: 2024/01/15)
- YYYY.MM.DD (例: 2024.01.15)

Excelのシリアル値（数値）も自動的に日付形式に変換されます。

## 技術スタック

- **言語**: Rust 2024 Edition
- **Excelライブラリ**:
  - `calamine` (読み取り)
  - `rust_xlsxwriter` (書き込み)
- **日付処理**: `chrono`
- **エラーハンドリング**: `color-eyre`
- **設定管理**: `toml`, `serde`

## ライセンス

このプロジェクトは内部使用を目的としています。
